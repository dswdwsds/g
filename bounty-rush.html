<!DOCTYPE html>
<html lang="ar">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>One Piece Bounty Rush | Professional GS</title>
  <link rel="stylesheet" href="style.css">
</head>

<body>

  <nav class="nav-bar">
    <div class="user-info" id="userInfo">
      <!-- Auth Content -->
    </div>
    <div class="logo" style="font-family: var(--font-en); font-weight: 800; color: var(--primary);">PRO GS</div>
  </nav>

  <header class="hero" style="padding-top: 120px;">
    <h1>One Piece Bounty Rush</h1>
    <p>Ù†Ù‚Ø¯Ù… Ø®Ø¯Ù…Ø© Ø±ÙØ¹ Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø´Ø®ØµÙŠØ§Øª Ø¨Ø³Ø±Ø¹Ø© ÙØ§Ø¦Ù‚Ø© ÙˆØ¶Ù…Ø§Ù† ÙƒØ§Ù…Ù„ Ø¶Ø¯ Ø£ÙŠ Ø®Ù„Ù„.</p>
  </header>

  <section class="queue-container" id="queueDashboard" class="hidden">
    <div class="queue-card">
      <span class="queue-status-tag">Live Queue ğŸ”´</span>
      <h2 style="margin-bottom: 5px;">Ø·Ø§Ø¨ÙˆØ± Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø± Ø§Ù„Ù…Ø¨Ø§Ø´Ø±</h2>
      <p id="queueBrief" style="color: var(--text-dim); font-size: 0.9rem;">Ø¨Ø§Ù†ØªØ¸Ø§Ø± Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª...</p>

      <div class="queue-list" id="queueList">
        <!-- Queue items will appear here -->
      </div>
    </div>
  </section>

  <section class="character-tiers">
    <div class="tier-card">
      <span class="tier-stars">â­â­</span>
      <h3>Starter Tier</h3>
      <span class="tier-price">30<span class="tier-currency"> SAR</span></span>
      <p>Ø±ÙØ¹ Ø³Ø±ÙŠØ¹ Ù„Ù„Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</p>
      <button class="auth-btn" style="margin-top:20px; width: 100%;" onclick="orderNow('Starter')">Ø·Ù„Ø¨ Ù‡Ø°Ù‡
        Ø§Ù„ÙØ¦Ø©</button>
    </div>

    <div class="tier-card" style="border-color: var(--primary);">
      <span class="tier-stars">â­â­â­</span>
      <h3>Pro Tier</h3>
      <span class="tier-price">60<span class="tier-currency"> SAR</span></span>
      <p>ØªØ­Ø³ÙŠÙ† ÙƒØ¨ÙŠØ± Ù„Ù†Ù‚Ø§Ø· Ø§Ù„Ø´Ø®ØµÙŠØ©</p>
      <button class="auth-btn" style="margin-top:20px; width: 100%;" onclick="orderNow('Pro')">Ø·Ù„Ø¨ Ù‡Ø°Ù‡ Ø§Ù„ÙØ¦Ø©</button>
    </div>

    <div class="tier-card">
      <span class="tier-stars">â­â­â­â­</span>
      <h3>Ultimate Tier</h3>
      <span class="tier-price">90<span class="tier-currency"> SAR</span></span>
      <p>Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰ Ù…Ù† Ø§Ù„Ù‚ÙˆØ©</p>
      <button class="auth-btn" style="margin-top:20px; width: 100%;" onclick="orderNow('Ultimate')">Ø·Ù„Ø¨ Ù‡Ø°Ù‡
        Ø§Ù„ÙØ¦Ø©</button>
    </div>
  </section>

  <div style="text-align: center; margin-bottom: 100px;">
    <p class="note">
      ğŸ›¡ï¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø¢Ù…Ù†Ø© ØªÙ…Ø§Ù…Ø§Ù‹ ÙˆØªØªÙ… Ø¹Ø¨Ø± Ø®Ø¨Ø±Ø§Ø¡ Ù…ØªØ®ØµØµÙŠÙ†.
      <br>
      âš ï¸ Ø¥Ø®Ù„Ø§Ø¡ Ù…Ø³Ø¤ÙˆÙ„ÙŠØ©: Ù†Ø­Ù† Ø¬Ù‡Ø© Ø®Ø§Ø±Ø¬ÙŠØ© ÙˆÙ„Ø§ Ù†ØªØ¨Ø¹ Ø´Ø±ÙƒØ© Bandai Namco.
    </p>
  </div>

  <footer>
    <p><a href="index.html" style="color: var(--primary); text-decoration: none;">â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a></p>
  </footer>

  <script type="module">
    import { auth, onAuthStateChanged } from './firebase-config.js';
    import { login, logout, placeOrder, listenToQueue, updateOrderStatus } from './app.js';

    const userInfo = document.getElementById('userInfo');
    const queueList = document.getElementById('queueList');
    const queueBrief = document.getElementById('queueBrief');

    const ADMIN_EMAIL = 'abdobwd78@gmail.com'; // Ø¨Ø±ÙŠØ¯Ùƒ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ ÙƒÙ…Ø¯ÙŠØ±

    window.orderNow = (tier) => {
      if (!auth.currentUser) {
        login();
      } else {
        placeOrder(tier);
      }
    };

    window.updateStatus = (id, status) => {
      if (confirm(`Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØºÙŠÙŠØ± Ø­Ø§Ù„Ø© Ø§Ù„Ø·Ù„Ø¨ Ø¥Ù„Ù‰ ${status === 'working' ? 'Ø¨Ø¯Ø¡ Ø§Ù„Ø¹Ù…Ù„' : status === 'done' ? 'Ø¥Ù†Ù‡Ø§Ø¡' : 'Ø±ÙØ¶'}ØŸ`)) {
        updateOrderStatus(id, status);
      }
    };

    onAuthStateChanged(auth, (user) => {
      if (user) {
        userInfo.innerHTML = `
                <div class="user-profile">
                    <img src="${user.photoURL}" class="user-avatar">
                    <span class="user-name">${user.displayName}</span>
                    <button class="auth-btn" onclick="handleLogout()">Ø®Ø±ÙˆØ¬</button>
                </div>
            `;
      } else {
        userInfo.innerHTML = `<button class="auth-btn" onclick="handleLogin()">ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø¨Ø¬ÙˆØ¬Ù„</button>`;
      }
    });

    window.handleLogin = login;
    window.handleLogout = logout;

    listenToQueue((orders) => {
      queueList.innerHTML = '';
      if (orders.length === 0) {
        queueBrief.innerText = "Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£Ø­Ø¯ ÙÙŠ Ø§Ù„Ø·Ø§Ø¨ÙˆØ± Ø­Ø§Ù„ÙŠØ§Ù‹. ÙƒÙ† Ø§Ù„Ø£ÙˆÙ„!";
        return;
      }

      const myOrderIndex = orders.findIndex(o => o.uid === auth.currentUser?.uid);
      if (myOrderIndex !== -1) {
        queueBrief.innerText = myOrderIndex === 0 && orders[0].status === 'working'
          ? "Ø£Ù†Øª Ø§Ù„Ø£Ù† ÙÙŠ Ù…Ø±Ø­Ù„Ø© Ø§Ù„ØªÙ†ÙÙŠØ°! ğŸš€"
          : `Ø£Ù†Øª ÙÙŠ Ø§Ù„Ù…Ø±ÙƒØ² #${myOrderIndex + 1}ØŒ ÙŠÙˆØ¬Ø¯ ${myOrderIndex} Ù‚Ø¨Ù„Ùƒ.`;
      } else {
        queueBrief.innerText = `ÙŠÙˆØ¬Ø¯ Ø­Ø§Ù„ÙŠØ§Ù‹ ${orders.length} Ø·Ù„Ø¨Ø§Øª ÙÙŠ Ø§Ù„Ø·Ø§Ø¨ÙˆØ±.`;
      }

      orders.forEach((order, index) => {
        const isWorking = order.status === 'working';
        const item = document.createElement('div');
        item.className = `queue-item ${isWorking ? 'active' : ''} ${order.uid === auth.currentUser?.uid ? 'mine' : ''}`;

        let actionButtons = '';
        if (auth.currentUser?.email === ADMIN_EMAIL) {
          actionButtons = `
                    <div style="display:flex; gap:5px; margin-right:10px;">
                        ${order.status === 'waiting' ? `<button class="auth-btn" style="padding:4px 8px; font-size:11px; background:#4facfe" onclick="updateStatus('${order.id}', 'working')">Ø¨Ø¯Ø¡</button>` : ''}
                        ${order.status === 'working' ? `<button class="auth-btn" style="padding:4px 8px; font-size:11px; background:#00f2fe; color:#000" onclick="updateStatus('${order.id}', 'done')">Ø¥Ù†Ù‡Ø§Ø¡</button>` : ''}
                        <button class="auth-btn" style="padding:4px 8px; font-size:11px; background:#ff00c8" onclick="updateStatus('${order.id}', 'rejected')">Ø±ÙØ¶</button>
                    </div>
                `;
        }

        item.innerHTML = `
                <div style="display:flex; align-items:center; gap:10px; flex:1">
                    <img src="${order.userAvatar}" style="width:30px; height:30px; border-radius:50%">
                    <span>${order.userName.split(' ')[0]} - ${order.tier}</span>
                </div>
                ${actionButtons}
                <span class="pos-tag">${isWorking ? 'ğŸ”¥ Ø¬Ø§Ø±Ù Ø§Ù„Ø¹Ù…Ù„' : '#' + (index + 1)}</span>
            `;
        queueList.appendChild(item);
      });
    });
  </script>
</body>

</html>
